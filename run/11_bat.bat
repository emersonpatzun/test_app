@ECHO OFF

REM SET VARS
set UNIDAD_DISCO=D:
set DIRECTORIO_PROYECTO="D:\cursos_automation_test\curso_fw_mobile\05_proyecto\venture"
REM VARIABLE DONDE ALMACENAR EL JSON DE RESULTADOS - EN JENKINS CONFIGURAR EL CUCUMBER REPORTS EL PATH JSON CON ESTE VALOR
set DIRECTORIO_CUCUMBER_JSON="D:\cursos_automation_test\curso_fw_mobile\05_proyecto\venture"
REM UUID DEL DISPOSITIVO, OBTENERLO EJECUTANDO EN LA CMD: adb devices
set DEVICE=ZY225C4DM8
set DEVICE_NAME="Moto G 7 plus"
REM NOMBRE DE LA APK DEBE COLOCARSE EN "../VENTURE/APK.APK"
set APP="app_demo.apk"
REM NOMBRE DEL CUCUMBER PROFILE EN "../VENTURE/CONFIG/CUCUMBER.YML"
set CUCUMBER_PROFILE="adr"
REM NOMBRE DEL ARCHIVO FEATURE A EJECUTAR
set FEATURE="10_bat.feature"
REM TAGS A FILTRAR EN LA EJECUCIÓN
set TAGS="\"@regresion\""
REM VARIABLES PARA DETERMINAR EL NOMBRE DE LAS CARPETAS DE EVIDENCIA FECHA Y HORA DE EJECUCIÓN
set EXEC_HOUR=%time:~0,2%
if %EXEC_HOUR% leq 9 set EXEC_HOUR=0%EXEC_HOUR:~1,1%
set EXEC_MIN=%time:~3,2%
if %EXEC_MIN% leq 9 set EXEC_MIN=0%EXEC_MIN:~1,1%
REM VARIABLE QUE DETERMINA EL DIRECTORIO FINAL DE RESULTADOS
set PATH_RESULTS=evidencia/%date:~-4%%date:~3,2%%date:~0,2%/%EXEC_HOUR%%EXEC_MIN%/%DEVICE%

REM IR A UNIDAD DE DISCO Y DIRECTORIO PARA CORRER CUCUMBER
%UNIDAD_DISCO%
cd %DIRECTORIO_PROYECTO%

REM CREAR DIRECTORIO DE RESULTADOS "PATH_RESULTS" S
mkdir "%PATH_RESULTS%"

REM EJECUTAR CALABASH
bundle exec calabash-android run %APP% -t %TAGS% ADB_DEVICE_ARG="%DEVICE%" -p %CUCUMBER_PROFILE% features/%FEATURE% -f pretty -f html --out %PATH_RESULTS%/reporte.html -f pretty -f json --out %DIRECTORIO_CUCUMBER_JSON%/reporte.json

pause

exit
